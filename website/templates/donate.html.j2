{% extends "base.html.j2" %}

{%- block content -%}
<section>
    <div class="container">

        {# Add the user data #}
        {% if session.logged_in %}
            <div class="columns" style="text-align: center;">
                <div class="column is-3 is-offset-3">
                    <h1 class="title">User Experience</h1>
                    <p id="experience" class="subtitle">{{ "{0:,}".format(user.user_experience or 0) }}</p>
                </div>
                <div class="column is-3">
                    <h1 class="title">Pot Count</h1>
                    <p class="subtitle">{{ "{0:,}".format(user.plant_limit) }}</p>
                </div>
            </div>
            <hr />
        {% endif %}

        {# Add the checkout stuff #}
        <div class="columns is-multiline">
            <div class="column is-4 is-offset-4" style="text-align: center;">

                {% if not user.has_premium %}
                    <h1 class="title">Subscribe to Premium</h1>
                    <h1 class="title"><b>Â£3.00</b> monthly</h1>

                    <script src="https://js.stripe.com/v3/"></script>
                    <section class="stripe-payment" style="margin-bottom: 5px;">
                        <button type="button" id="stripe-checkout-button">Subscribe with Stripe</button>
                    </section>
                    <script type="text/javascript">
                    var stripe = Stripe("pk_live_0Fx3FqHVF6tDXipvuUxdSDeu00egEyOnyO");
                    document.getElementById("stripe-checkout-button").onclick = () => {
                        fetch("https://voxelfox.co.uk/webhooks/stripe/create_checkout_session", {
                            method: "POST",
                            body: JSON.stringify({
                                product_name: "Flower Premium",
                                discord_user_id: "{{ session.user_id }}",
                            }),
                        }).then(function (response) {
                            return response.json();
                        }).then(function (session) {
                            return stripe.redirectToCheckout({ sessionId: session.id });
                        }).then(function (result) {
                            if (result.error) {
                                alert(result.error.message);
                            }
                        }).catch(function (error) {
                            console.error("Error:", error);
                        });
                    };
                    </script>

                    <script src="https://www.paypal.com/sdk/js?client-id=AZrQypK2Od7C44Y1JgQAStWunNw7puFjVx0ako0rCOl2zJWuRpMNnm35uvxMCsPa-vNmJFAiHq-o0q61&vault=true"></script>
                    <div class="paypal-button" id="paypal-plan-container-P-5C533545H17816407MC6TYSY"></div>
                    <script>
                        paypal.Buttons({
                            style: {
                                label: 'subscribe',
                                color: 'gold',
                                tagline: false,
                                layout: 'horizontal',
                            },
                           createSubscription: function(data, actions) {
                                return actions.subscription.create({
                                   'plan_id': 'P-5C533545H17816407MC6TYSY'
                                });
                            },
                            onApprove: function(data, actions) {
                                alert(data.subscriptionID);
                            }
                        }).render('#paypal-plan-container-P-5C533545H17816407MC6TYSY');
                    </script>

                {% else %}
                    <h1 class="title">You are currently subscribed to Premium</h1>
                {% endif %}

            </div>
        </div>

    </div>
</section>
{%- endblock content -%}
